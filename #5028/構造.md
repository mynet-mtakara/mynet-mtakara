## 実際の環境

```
@startuml
package 実行環境 {
package フレームワーク {
map コード {
}
}
}
@enduml
note left of 実行環境 : 本案や開発環境
```

## テスト環境

```
@startuml
package 実行環境 {
package ユニットテスト {
map コード {
}

}
}
@enduml
note left of 実行環境 : ローカルや札幌サーバ
note bottom of ユニットテスト : データや時間などテストしたい状況を作る
```
- コード側は実際に動く環境と同じコードで変えないようにする
- ユニットテスト側（テスト側）で実際に動いてる状況（テストしたい）を作る

## ユニットテストの勘違いしやすいところ
- 負荷試験とは違う（負荷試験は別に用意すべき）
-  テストは速い方が良い（1時間で100テスオより1分で1000 テストの方がよい）
  - ループなどはできるだけしない
  - テストデータを数件程度にする（不要データ削除、何百件もテストで使わない） 
- できるだけ小さく作る
  - 通常コントローラーの方がモデルよりも関係範囲、必要データも多くなる。なるべくモデルをテストするようにする（現状はコントローラーテストの用意がない）
- ロジックはモデル側に入れていく
  - どこから呼ばれても同じ結果にするために必要（モデル側ではクッキーを扱ったり、HTMLを返却せずクッキーの値を引数にしたり、配列で返すようにする後述）
  - なるべく同じコードは共通化していく（ユニットテスト向き）
- シナリオテストはユニットテストとして良くない
  - 例えばチュートリアルを順番で呼び出すようなテスト（途中の仕様変わった時に後のテストがエラーになる。最後のテストまでに時間がかかる）
## テストの目的と効果
- テストの実行時間（少なくともテストを実行した箇所はシンタックスエラーがない）
- 改修の際に思いっきり修正できる（テストで同じ結果になることが保証される安心）
- 影響の出る範囲がテスト結果によりアラートになる（テストNGの状態にしないようにする）
## テストの範囲（実装の目安）
決めの問題なので、こうでなければいけないというのはない。なので良くある例
- 1ファイルに最低1テスト（文法エラーを防ぐ？）
- コードカバレッジ100％（理想ではあるが実現してるのは見たことない）
- 不具合修正の際には必ずテスト駆動型にする（同じ不具合は出ないようにする）
## MVCについて
- そもそもというところもあるが、そもそものMVC、共通化によるテストの考え方の整理
- ZendFrameworkが古めのフレームワークというのと10年前の実装、フレームワーク中でも自由度が高いため今時としては一般的でない部分が多々ある
  - MVCについてはググる大量にヒットする[MVCモデルについて](https://qiita.com/s_emoto/items/975cc38a3e0de462966a)
- ロジックをモデルに寄せる。（結果が同じだから良いじゃんと言う考えではすべてをコントローラーにもビューにでも書けてしまう）
  - 先に書いたようにどこから呼んでも同じ結果を容易に出せるようにしたい（Webから呼んでもバッチから呼んでも）
  - コントローラーはWebとモデルの橋渡し（クッキーをモデル側で扱うとバッチから呼ばれると動かなくなる）
  - ビューは表示の仕方を決める（モデルで日本語で返すと英語で表示する場合はモデルを直す？ビューを直す？）＜現在のドラタクはかなり難しい状況
    - ドラタクではビューで共通化されてる部分があり、今から直すのはかなりキツい（テストしやすいようにモデルに寄せるべき場所はかなりある）
## 長く有効に続けていくために
- 範囲を小さく、速く（テストケース1000件超えてから改善しようとしても難しい）
- プッシュすると自動的にテストが行われるようにする(github Actionで実行するようなのも可能。有料)


## 環境

実際の環境|テスト環境
--|--
![RSxD2W5H60RW_Lp5kGuhjp8O5kOlZfKipldaRomqYfGI2uL8YPeY5_EQ6Ux2ETIKKcVn_RrF9r_dPeqt7DlmpMBLh5WiFYoUos4Q7kCLiMOs1gr10OX0FL07CbA5sZkcpo1Fe2keh_gMeLxBo5jkIQkknorcMsNElF8ldLFaNiVa3hI3R2VpVHmD8SyVQ_ID5ZpEFKU7_tz0AzsFSjV4JBucOuWjn2QxWPX2B23QwU2Id0Ha](https://user-images.githubusercontent.com/99715301/185535791-fdf20e88-51eb-4962-a950-a71f124f9db9.png)|![SoWkIImgAStDuIf8JCvEJ4zLUBfk_ek5FSydRNYwg5cX6Yxyk7dgu-OrZvltF6vUyBXvFOZHj1uedvjOeF2uQJDOeXF8hmL3XzIy592XUVabgGevgMab2lbfg2PRAJoRi-RPmex7JIqlftK_dxaB8Wu0](https://user-images.githubusercontent.com/99715301/185535942-96f5c030-80d9-4cc0-b2eb-27c9e9d1d185.png)
